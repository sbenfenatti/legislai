<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passo 5: Simulador de Tramitação</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lato', sans-serif; background: linear-gradient(125deg, #0f172a, #0d9488, #083344, #1e293b, #0f172a); background-size: 400% 400%; animation: liquidGradient 20s ease infinite; overflow-x: hidden; }
        @keyframes liquidGradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-card { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border-radius: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
        .btn-glow { background: #06b6d4; background: linear-gradient(45deg, #0891b2, #22d3ee); transition: all 0.3s ease; box-shadow: 0 4px 15px 0 rgba(14, 165, 233, 0.4); }
        .btn-glow:hover { transform: translateY(-2px); box-shadow: 0 6px 20px 0 rgba(14, 165, 233, 0.6); }
        .btn-secondary { background: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.15); transition: all 0.3s ease; }
        .btn-secondary:hover { background: rgba(0, 0, 0, 0.3); border-color: rgba(255, 255, 255, 0.25); }
        .progress-bar-bg { background-color: rgba(0,0,0,0.3); }
        .progress-bar-fill { background-color: #22d3ee; transition: width 0.5s ease-in-out; }
        .commission-card { background: rgba(0, 0, 0, 0.25); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
        .commission-card.relevant { border-color: rgba(34, 211, 238, 0.5); background: rgba(8, 51, 68, 0.5); cursor: pointer; }
        .commission-card.relevant:hover { border-color: rgba(34, 211, 238, 0.8); background: rgba(8, 51, 68, 0.7); }
        .commission-card.irrelevant { opacity: 0.6; position: relative; }
        .analysis-panel { display: none; background-color: rgba(2, 6, 23, 0.5); border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .status-approved { color: #22c55e; border-color: #22c55e; }
        .status-warning { color: #f97316; border-color: #f97316; }
        .tooltip-text { visibility: hidden; opacity: 0; width: 220px; background-color: rgba(15, 23, 42, 0.9); color: #fff; text-align: center; border-radius: 0.75rem; padding: 8px 12px; position: absolute; z-index: 10; bottom: 110%; left: 50%; margin-left: -110px; transition: opacity 0.3s; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); font-size: 0.875rem; }
        .commission-card.irrelevant:hover .tooltip-text { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="text-gray-200 min-h-screen">
    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-black text-white tracking-tight">Plataforma de Criação Legislativa</h1>
            <p class="text-cyan-200 mt-2 text-lg font-semibold">Juntos para servir</p>
        </header>

        <main>
            <div class="glass-card p-8 md:p-10">
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-cyan-200">Passo 5 de 5</span>
                    </div>
                    <div class="w-full progress-bar-bg rounded-full h-2">
                        <div class="progress-bar-fill h-2 rounded-full" style="width: 100%"></div>
                    </div>
                </div>

                <h2 class="text-3xl font-bold text-white mb-2">Simulador de Tramitação na ALMG</h2>
                <p class="text-cyan-200 mb-8">A IA analisou seu projeto e simulou a passagem pelas comissões. Clique nas comissões em destaque para ver a análise.</p>
                
                <div id="comissoes-dinamicas" class="pl-1 flex flex-wrap gap-2 mb-4"></div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-10">
                    <div class="commission-card relevant rounded-xl" onclick="toggleAnalysis('ccj')">
                        <div class="p-4">
                            <p class="font-bold text-white">Constituição e Justiça</p>
                            <p class="text-sm text-cyan-200">Análise de legalidade</p>
                        </div>
                        <div id="ccj" class="analysis-panel p-4">
                            <p class="font-bold text-lg border-l-4 pl-3 mb-3 status-warning">PARECER: Aprovado com Ressalvas</p>
                            <p class="text-sm text-gray-300"><strong class="text-white">Análise:</strong> O projeto é constitucional em seu mérito. <strong class="text-orange-400">Alerta:</strong> O Art. 3º, que trata de despesas, precisa de compatibilidade explícita com PPAG e LDO.</p>
                        </div>
                    </div>
                    <div class="commission-card relevant rounded-xl" onclick="toggleAnalysis('saude')">
                        <div class="p-4">
                            <p class="font-bold text-white">Saúde</p>
                            <p class="text-sm text-cyan-200">Análise de mérito</p>
                        </div>
                        <div id="saude" class="analysis-panel p-4">
                            <p class="font-bold text-lg border-l-4 pl-3 mb-3 status-approved">PARECER: Aprovado</p>
                            <p class="text-sm text-gray-300"><strong class="text-white">Análise:</strong> O projeto ataca filas e absenteísmo com solução moderna de saúde digital.</p>
                        </div>
                    </div>
                    <div class="commission-card relevant rounded-xl" onclick="toggleAnalysis('ffo')">
                        <div class="p-4">
                            <p class="font-bold text-white">Fiscalização Financeira</p>
                            <p class="text-sm text-cyan-200">Análise orçamentária</p>
                        </div>
                        <div id="ffo" class="analysis-panel p-4">
                            <p class="font-bold text-lg border-l-4 pl-3 mb-3 status-warning">PARECER: Aprovado com Ressalvas</p>
                            <p class="text-sm text-gray-300"><strong class="text-white">Análise:</strong> Exigir estudo de impacto orçamentário-financeiro e indicação clara de fontes.</p>
                        </div>
                    </div>
                    <div class="commission-card relevant rounded-xl" onclick="toggleAnalysis('ciencia')">
                        <div class="p-4">
                            <p class="font-bold text-white">Ciência e Tecnologia</p>
                            <p class="text-sm text-cyan-200">Análise de inovação</p>
                        </div>
                        <div id="ciencia" class="analysis-panel p-4">
                            <p class="font-bold text-lg border-l-4 pl-3 mb-3 status-approved">PARECER: Aprovado</p>
                            <p class="text-sm text-gray-300"><strong class="text-white">Análise:</strong> Incentiva modernização e pode virar referência.</p>
                        </div>
                    </div>
                    <div class="commission-card irrelevant rounded-xl"><div class="p-4"><p class="font-bold text-white">Agropecuária</p></div><span class="tooltip-text">Sem relação direta.</span></div>
                    <div class="commission-card irrelevant rounded-xl"><div class="p-4"><p class="font-bold text-white">Defesa do Consumidor</p></div><span class="tooltip-text">Sem relação direta.</span></div>
                </div>

                <div class="flex justify-between mt-12 pt-8 border-t border-white/10">
                    <button class="btn-secondary inline-flex items-center py-2 px-6 rounded-lg font-semibold">Voltar</button>
                    <button class="btn-glow inline-flex items-center py-3 px-10 rounded-lg text-white font-semibold">Concluir e Salvar Projeto</button>
                </div>
            </div>
        </main>
    </div>
    <script>
        function toggleAnalysis(commissionId){const panel=document.getElementById(commissionId);if(panel.style.display==='block'){panel.style.display='none'}else{document.querySelectorAll('.analysis-panel').forEach(p=>p.style.display='none');panel.style.display='block'}}
        const API_BASE_5=(localStorage.getItem('api_base'))||(location.origin.startsWith('http')?location.origin:'http://127.0.0.1:8010');
        async function carregarComissoes(){
          try{
            const r=await fetch(`${API_BASE_5}/api/v1/legislative/commissions`);
            const j=await r.json();
            const lista=(j&&j.data&&j.data.comissoes)?j.data.comissoes:[];
            const cont=document.getElementById('comissoes-dinamicas');
            cont.innerHTML='';
            lista.forEach(c=>{const chip=document.createElement('span');chip.className='text-xs px-2 py-1 rounded-full border border-cyan-400/40 text-cyan-200';chip.textContent=c.nome;cont.appendChild(chip)});
          }catch(e){}
        }
        document.addEventListener('DOMContentLoaded',carregarComissoes);
    </script>
</body>
</html>
